# Requirements_definition_advanced.md

## 1. コンセプト
### **OMAMORI（おまもり）**
* **スローガン**: 「聞かずに安心、触れずに報告」
* **目的**: 大切な人との間で、安否・服薬・ルーチン家事などの状況を、スマホを「開かず」に共有し合う。
* **デザイン方針**: `design.md` を参照。レトロポップな色彩と、物理的なボタンのようなニューモーフィズムを融合させた「触りたくなる」UI。

## 2. ユーザーフロー
1. **【アプリで登録】**: アプリ本体でタスク（例：「朝の薬」「戸締まり」）を登録。
2. **【ウィジェットで確認】**: ホーム画面のウィジェットで、自分やパートナーの状況をチラ見する。
3. **【ウィジェットで報告】**: 自分が完了したら、ウィジェットのカードをタップ。ニューモーフィズムのボタンが「ググッ」と押し込まれる演出。
4. **【済のまま維持】**: 完了後もウィジェットには「済」として残り続け、安心感を提供。
5. **【自動リセット】**: 完了から指定時間（例：1時間、3時間、24時間後）経過後に自動で未完了に戻る。

## 3. 具体的な機能要件
### 3.1 タスク登録・管理（アプリ本体）
* **入力項目**: タスク名、リセットルール（なし / 完了からX時間後）。
* **編集機能**: タスクカード上の「編集ボタン」から修正可能（長押し操作は廃止）。
* **パートナー管理**:
    *   最大3人までパートナーを登録可能。
    *   パートナーIDと「ニックネーム」を設定・編集可能。
    *   ホーム画面をスワイプして「自分のタスク」と「各パートナーのタスク」を切り替え。

### 3.2 相互マルチカード・ウィジェット（ホーム画面）
* **カード形式レイアウト**: ニューモーフィズムデザインのカード。
    *   **Undone（未完了）**: 凸状態。視認性の高いデザイン。
    *   **Done（完了）**: 凹状態。文字色を調整し、視認性を維持しつつ完了状態を表現。
* **サイズ別表示数**:
    *   **小 (Small)**: 1タスク（大きく表示）
    *   **中 (Medium)**: 2タスク（横並び）
    *   **大 (Large)**: 6タスク（2列 x 3行）
* **独立表示モード**:
    *   ウィジェットごとに表示対象（My Tasks, Partner 1, Partner 2, Partner 3）を設定可能。
    *   ウィジェット編集画面（Configuration）でモードを選択。
    *   ヘッダーには設定した「パートナーのニックネーム」を表示。

### 3.3 ロック画面ウィジェット
* **アクセサリ表示**: 時計下の極小スペースにアイコンとステータスを常駐表示（※将来実装 / 現状はホーム画面ウィジェットに注力）。

## 4. 技術仕様
* **Backend**: Supabase (Realtime / Edge Functions) ※現在はローカル/UserDefaultsでシミュレーション中。
* **Frontend**: Flutter & SwiftUI (Interactive Widget / AppIntent)
* **Sync**: home_widget パッケージによるデータブリッジ（FlutterアプリとSwiftUIウィジェット間のデータ共有）。
    *   `UserDefaults` を使用して、タスクリストとパートナー名を共有。

## 5. デザイン
デザインはdesign.mdを参照してください。

---

